//
//  MyExploitViewController.m
//  CarWashing
//
//  Created by apple on 2017/11/21.
//  Copyright © 2017年 DS. All rights reserved.
//

#import "MyExploitViewController.h"
#import "CyStrategyViewController.h"
#import "MyLibListCollectionViewCell.h"
#import "MyExploitModel.h"
// 注意const的位置
static NSString *const cellId = @"cellId";
static NSString *const headerId = @"headerId";
@interface MyExploitViewController ()<UICollectionViewDelegate,UICollectionViewDataSource>

@property (nonatomic,strong) UICollectionView * collectionView;
@property (nonatomic,strong) UILabel *rightExpLabel333;
@property (nonatomic,strong) NSMutableArray *signArray;
@property (nonatomic,strong) NSMutableArray *wenZArray;
@property (nonatomic,strong) NSMutableArray *PraiseArray;
@end

@implementation MyExploitViewController


- (void)viewDidLoad {
    [super viewDidLoad];
    _signArray=[NSMutableArray array];
    _wenZArray=[NSMutableArray array];
    _PraiseArray=[NSMutableArray array];
    self.view.backgroundColor=[UIColor whiteColor];
    [self setNav];
    [self getData];
    UIView * headerView=[[UIView alloc]initWithFrame:CGRectMake(0, 64, Main_Screen_Width, 140)];
    headerView.backgroundColor = [UIColor colorFromHex:@"#314060"];
    headerView.userInteractionEnabled  = YES;
    UITapGestureRecognizer * tap = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(tapClick)];
    [headerView addGestureRecognizer:tap];
    [self.view addSubview:headerView];
    //经验值
    UILabel *exceLabel = [[UILabel alloc]initWithFrame:CGRectMake(15, 30, 100, 40)];
    exceLabel.font=[UIFont systemFontOfSize:45.0];
    exceLabel.text = [NSString stringWithFormat:@"%@",self.num];
    exceLabel.textAlignment = NSTextAlignmentLeft;
    exceLabel.textColor =[UIColor colorFromHex:@"#ffffff"];
    [headerView addSubview:exceLabel];
    UILabel *nameLabel = [[UILabel alloc]init];
    nameLabel.font=[UIFont systemFontOfSize:18.0];
    nameLabel.text = @"经验值";
    nameLabel.textColor =[UIColor colorFromHex:@"#ffffff"];
    [headerView addSubview:nameLabel];
    if (exceLabel.text.length==2) {
        [nameLabel mas_makeConstraints:^(MASConstraintMaker *make) {
            make.bottom.mas_equalTo(exceLabel.mas_bottom);
            make.left.mas_equalTo(exceLabel.mas_right).mas_offset(-30);
            make.size.mas_equalTo(CGSizeMake(100, 20));
        }];
    }else if (exceLabel.text.length==3){
        [nameLabel mas_makeConstraints:^(MASConstraintMaker *make) {
            make.bottom.mas_equalTo(exceLabel.mas_bottom);
            make.left.mas_equalTo(exceLabel.mas_right).mas_offset(-10);
            make.size.mas_equalTo(CGSizeMake(100, 20));
        }];
    }else if (exceLabel.text.length==1){
        [nameLabel mas_makeConstraints:^(MASConstraintMaker *make) {
            make.bottom.mas_equalTo(exceLabel.mas_bottom);
            make.left.mas_equalTo(exceLabel.mas_right).mas_offset(-60);
            make.size.mas_equalTo(CGSizeMake(100, 20));
        }];
    }
   
    UIImageView * rightimage=[[UIImageView alloc]init];
    rightimage.image= [UIImage imageNamed:@"jingyanzhi"];
    [headerView addSubview:rightimage];
    [rightimage mas_makeConstraints:^(MASConstraintMaker *make) {
        make.bottom.mas_equalTo(exceLabel.mas_bottom);
        make.right.mas_equalTo(headerView.mas_right).mas_offset(-15);
        make.size.mas_equalTo(CGSizeMake(45, 55));
    }];
    UIView * lineView=[[UIView alloc]init];
    lineView.backgroundColor = [UIColor colorFromHex:@"#687ca6"];
    [headerView addSubview:lineView];
    [lineView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(exceLabel.mas_bottom).mas_offset(25);
        make.left.mas_equalTo(headerView.mas_left);
        make.right.mas_equalTo(headerView.mas_right);
        make.height.mas_equalTo(1);
    }];
    //差的经验值
    UILabel *needExpLabel = [[UILabel alloc]init];
    needExpLabel.font=[UIFont systemFontOfSize:15.0];
    needExpLabel.text = @"还需234可升级";
    needExpLabel.textAlignment = NSTextAlignmentLeft;
    needExpLabel.textColor =[UIColor colorFromHex:@"#687ca6"];
    [headerView addSubview:needExpLabel];
    [needExpLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(lineView.mas_bottom);
        make.left.mas_equalTo(headerView.mas_left).mas_offset(15);
        make.size.mas_equalTo(CGSizeMake(150, 40));
    }];
    //升级攻略相关
    UIView * rightView=[[UIView alloc]init];
    rightView.backgroundColor=[UIColor colorFromHex:@"#687ca6"];
    rightView.layer.cornerRadius = 10;
    rightView.layer.masksToBounds = YES;
    [headerView addSubview:rightView];
    [rightView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.mas_equalTo(needExpLabel.mas_centerY);
        make.right.mas_equalTo(headerView.mas_right).mas_offset(-15);
        make.size.mas_equalTo(CGSizeMake(75, 20));
    }];
    UILabel *rightExpLabel = [[UILabel alloc]init];
    rightExpLabel.font=[UIFont systemFontOfSize:12.0];
    rightExpLabel.text = @"升级攻略";
    rightExpLabel.textAlignment = NSTextAlignmentCenter;
    rightExpLabel.textColor =[UIColor colorFromHex:@"#202c45"];
    [rightView addSubview:rightExpLabel];
    [rightExpLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(rightView.mas_top);
        make.bottom.mas_equalTo(rightView.mas_bottom);
        make.left.mas_equalTo(rightView.mas_left).mas_offset(8);
        make.width.mas_equalTo(50);
    }];
    UIImageView * rightimage1=[[UIImageView alloc]init];
    rightimage1.image= [UIImage imageNamed:@"shengjigonglue-1"];
    [rightView addSubview:rightimage1];
    [rightimage1 mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.mas_equalTo(rightExpLabel.mas_centerY);
        make.right.mas_equalTo(rightView.mas_right).mas_offset(-5);
        make.size.mas_equalTo(CGSizeMake(7, 12));
    }];
    UILabel * titleLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 204, Main_Screen_Width, 30)];
    titleLabel.backgroundColor=[UIColor whiteColor];
    titleLabel.text = @"我获得的勋章";
    titleLabel.textAlignment = NSTextAlignmentCenter;
    titleLabel.font = [UIFont systemFontOfSize:15.0*Main_Screen_Height/667];
    titleLabel.textColor =[UIColor colorFromHex:@"#3f3f3f"];
    [self.view addSubview:titleLabel];
    [self loadCollectionView];
}
-(void)setNav{
    UIView * view=[[UIView alloc]initWithFrame:CGRectMake(0, 0, Main_Screen_Width, 64)];
    view.backgroundColor=[UIColor colorFromHex:@"#314060"];
    [self.view addSubview:view];
    UIImageView * leftimage=[[UIImageView alloc]initWithFrame:CGRectMake(15, 30, 13, 20)];
    leftimage.image= [UIImage imageNamed:@"icon_titlebar_arrow"];
    [view addSubview:leftimage];
    UIButton * leftButton = [UIButton buttonWithType:UIButtonTypeCustom];
    leftButton.frame = CGRectMake(0, 0, 100, 64);
    [leftButton addTarget:self action:@selector(leftBtnClick) forControlEvents:UIControlEventTouchUpInside];
    [view addSubview:leftButton];
    UILabel * titleLabel = [[UILabel alloc]init];
    titleLabel.text=@"我的功勋";
    titleLabel.font=[UIFont boldSystemFontOfSize:18.0];
    titleLabel.textAlignment = NSTextAlignmentCenter;
    titleLabel.textColor=[UIColor whiteColor];
    [view addSubview:titleLabel];
    [titleLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(view.mas_centerX);
        make.centerY.mas_equalTo(leftimage.mas_centerY);
        make.size.mas_equalTo(CGSizeMake(200, 20));
    }];
}
-(void)leftBtnClick
{
    [self.navigationController popViewControllerAnimated:YES];
}
-(void)tapClick
{
    CyStrategyViewController * vc =[[CyStrategyViewController alloc]init];
    vc.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:vc animated:YES];
}
-(void)getData
{
    NSDictionary *mulDic = @{
                             @"Account_Id":[UdStorage getObjectforKey:@"Account_Id"]
                             };
    NSDictionary *params = @{
                             @"JsonData" : [NSString stringWithFormat:@"%@",[AFNetworkingTool convertToJsonData:mulDic]],
                             @"Sign" : [NSString stringWithFormat:@"%@",[LCMD5Tool md5:[AFNetworkingTool convertToJsonData:mulDic]]]
                             };
    [AFNetworkingTool post:params andurl:[NSString stringWithFormat:@"%@Empirical/GetMyMedalList",Khttp] success:^(NSDictionary *dict, BOOL success) {
        NSLog(@"--%@",dict);
        
        if ([dict[@"ResultCode"]isEqualToString:@"F000000"]) {
            _wenZArray = (NSMutableArray*)[MyExploitModel mj_objectArrayWithKeyValuesArray:dict[@"JsonData"][@"CommunityList"]];
            _signArray = (NSMutableArray*)[MyExploitModel mj_objectArrayWithKeyValuesArray:dict[@"JsonData"][@"landList"]];
            _PraiseArray= (NSMutableArray*)[MyExploitModel mj_objectArrayWithKeyValuesArray:dict[@"JsonData"][@"GiveList"]];
        }
        [self.collectionView reloadData];
    } fail:^(NSError *error) {
        NSLog(@"%@",error);
    }];
}
#pragma mark----表
- (void)loadCollectionView
{
    UICollectionViewFlowLayout*_customLayout = [[UICollectionViewFlowLayout alloc] init]; // 自定义的布局对象
    _collectionView = [[UICollectionView alloc] initWithFrame:CGRectMake(0, 234, Main_Screen_Width, Main_Screen_Height-234) collectionViewLayout:_customLayout];
    _collectionView.backgroundColor = [UIColor whiteColor];
    _collectionView.dataSource = self;
    _collectionView.delegate = self;
    [self.view addSubview:_collectionView];
    //这种是xib建的cell 需要这么注册
    UINib *cellNib=[UINib nibWithNibName:@"MyLibListCollectionViewCell" bundle:nil];
    [_collectionView registerNib:cellNib forCellWithReuseIdentifier:@"CollectionViewCell"];
   
    [_collectionView registerClass:[UICollectionReusableView class]
       forSupplementaryViewOfKind:UICollectionElementKindSectionHeader
              withReuseIdentifier:headerId];
//    UINib * nib = [UINib nibWithNibName:@"THFindStyleHeaderView" bundle:nil];
//    [self.collectionView registerNib:nib
//          forSupplementaryViewOfKind:UICollectionElementKindSectionHeader
//                 withReuseIdentifier:headerId];
    // 注册cell、sectionHeader、sectionFooter
    //    [_collectionView registerClass:[UICollectionReusableView class] forSupplementaryViewOfKind:UICollectionElementKindSectionHeader withReuseIdentifier:headerId];
    //    [_collectionView registerClass:[UICollectionReusableView class] forSupplementaryViewOfKind:UICollectionElementKindSectionFooter withReuseIdentifier:footerId];
}
- (NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView
{
    return 3;
}


- (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section
{
    if (section==0) {
      return  self.signArray.count;
    }else if (section==1){
      return  self.wenZArray.count;
    }
      return  self.PraiseArray.count;
    
    
}

- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath
{
    MyLibListCollectionViewCell *cell=[collectionView dequeueReusableCellWithReuseIdentifier:@"CollectionViewCell" forIndexPath:indexPath];
    if (indexPath.section==0) {
        [cell configCell0:self.signArray[indexPath.row]];
    }else if (indexPath.section==1){
         [cell configCell1:self.wenZArray[indexPath.row]];
    }else if (indexPath.section==2)
     [cell configCell2:self.PraiseArray[indexPath.row]];
    
    return cell;
}

#pragma mark ---- UICollectionViewDelegateFlowLayout

- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath
{
    return (CGSize){(Main_Screen_Width-20)/3,(Main_Screen_Width-20)/3};
}
- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout referenceSizeForHeaderInSection:(NSInteger)section{
   return (CGSize){Main_Screen_Width,30};;
}
- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout insetForSectionAtIndex:(NSInteger)section
{
    return UIEdgeInsetsMake(5, 5, 5, 5);
}

- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section
{
    return 5.f;
}

- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section
{
    return 5.f;
}

#pragma mark ---- UICollectionViewDelegate

- (BOOL)collectionView:(UICollectionView *)collectionView shouldHighlightItemAtIndexPath:(NSIndexPath *)indexPath
{
    return YES;
}
// 选中某item
- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath
{
}
//对头视图或者尾视图进行设置
- (UICollectionReusableView *)collectionView:(UICollectionView *)collectionView viewForSupplementaryElementOfKind:(NSString *)kind atIndexPath:(NSIndexPath *)indexPath {
    //如果是头视图
    if ([kind isEqualToString:UICollectionElementKindSectionHeader]) {
        UICollectionReusableView *header=[collectionView dequeueReusableSupplementaryViewOfKind:kind withReuseIdentifier:headerId forIndexPath:indexPath];
        header.backgroundColor=RGBAA(242, 242, 242, 1.0);
        //头视图添加view
        [header addSubview:self.rightExpLabel333];
        if (indexPath.section==0) {
            _rightExpLabel333.text = @"登录勋章";
        }else if (indexPath.section==1){
            _rightExpLabel333.text = @"社区勋章";
        }else if (indexPath.section==2){
            _rightExpLabel333.text = @"点赞勋章";
        }
        return header;
    }
    
    //如果底部视图
    return nil;
}
-(UILabel *)rightExpLabel333
{
    if (_rightExpLabel333==nil) {
        _rightExpLabel333 = [[UILabel alloc]init];
        _rightExpLabel333.frame =CGRectMake(10, 0, Main_Screen_Width,30);
        _rightExpLabel333.font=[UIFont systemFontOfSize:15.0*Main_Screen_Height/667];
        _rightExpLabel333.textColor =[UIColor colorFromHex:@"#202c45"];
    }
    return _rightExpLabel333;
}


@end
